---
import Base from "~/layouts/Base.astro";
import Section from "~/components/Section.astro";
import ProjectCard from "~/components/ProjectCard.astro";
import MotionReveal from "~/components/MotionReveal";
import HeroStatic from "~/components/HeroStatic.astro";
import HeroVisualStatic from "~/components/HeroVisualStatic.astro";
import LogoMarquee from "~/components/LogoMarquee.astro";
import TiltingCard from "~/components/TiltingCard";
import PillImageReveal from "~/components/PillImageReveal.astro";
import ProcessStepCard from "~/components/ProcessStepCard";
import { getCollection } from "astro:content";
import { SITE } from "~/lib/seo";

const projects = await getCollection("projects", ({ data }) => data.featured);
const featured = projects.sort((a, b) => (a.data.date > b.data.date ? -1 : 1)).slice(0, 4);
const servicesCollection = await getCollection("services");
const testimonials = await getCollection("testimonials");
const marqueeLogos = [
  { prefix: "EdTech", label: "Admin Panel SMA" },
  { prefix: "LMS", label: "Classroom Informatika" },
  { prefix: "Live Learning", label: "GEMA SMAWA" },
  { prefix: "Retail", label: "Kios POS" },
  { prefix: "Enterprise", label: "Buroq Admin Panel" },
  { prefix: "Fintech", label: "Elysian Bank" },
  { prefix: "Streaming", label: "Nebula TV" },
  { prefix: "Ecommerce", label: "Aurora Commerce" },
  { prefix: "Health", label: "Pulse Health" },
];
const impactHighlights = [
  {
    title: "Sistem manajemen sekolah terpusat untuk SMA",
    description:
      "Admin Panel SMA menggabungkan TypeScript dan React untuk mencatat kehadiran dan nilai akademik secara real-time, mengurangi pekerjaan manual administrasi dengan interface responsif.",
    metric: "Data aman & terpusat",
    icon: "ðŸŽ“",
  },
  {
    title: "Platform pembelajaran digital komprehensif",
    description:
      "GEMA SMAWA mengintegrasikan manajemen siswa, konten tutorial, dan interaksi real-time dengan Next.js 15 dan LiveKit untuk meningkatkan engagement siswa dalam satu ekosistem terpadu.",
    metric: "Engagement lebih tinggi",
    icon: "ðŸ“¡",
  },
  {
    title: "Sistem kasir digital untuk retail modern",
    description:
      "Kios POS menyediakan platform Point of Sale berbasis web dengan TypeScript, memproses transaksi kurang dari 3 detik per item dengan cloud-ready deployment di Vercel.",
    metric: "<3s per transaksi",
    icon: "ðŸ›’",
  },
  {
    title: "Dashboard enterprise dengan integrasi lengkap",
    description:
      "Buroq Admin Panel menggabungkan React 18+, TypeScript, dan Vite untuk centralized management system dengan Google Maps integration dan WhatsApp Business automation.",
    metric: "Type-safe & modular",
    icon: "âš™ï¸",
  },
];
const processSteps = [
  {
    step: "01",
    title: "Analisis & Perencanaan",
    description:
      "Mengidentifikasi kebutuhan bisnis, merancang arsitektur sistem, dan menentukan tech stack optimal (React/Next.js, Node.js/Golang, PostgreSQL) sebelum eksekusi.",
  },
  {
    step: "02",
    title: "Desain API & Database",
    description:
      "Merancang RESTful API, skema database relasional, dan struktur data yang scalable dengan fokus pada efisiensi query dan integritas data.",
  },
  {
    step: "03",
    title: "Development Full-Stack",
    description:
      "Implementasi backend (Node.js/Golang) dan frontend (React/Next.js) dengan TypeScript, state management modern, dan integrasi real-time menggunakan WebSocket/Redis.",
  },
  {
    step: "04",
    title: "Deployment & Maintenance",
    description:
      "Deploy ke production (Vercel, Railway, Supabase), setup monitoring, optimisasi performa, dan dokumentasi teknis untuk kemudahan maintenance jangka panjang.",
  },
];
const primaryService = servicesCollection[0]?.data;

const homePageSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  name: SITE.title,
  description: SITE.description,
  url: SITE.url,
};
---

<Base structuredData={homePageSchema}>
  <section class="relative overflow-hidden">
    <div
      aria-hidden="true"
      class="absolute inset-0 -z-10 bg-gradient-to-br from-accent/10 via-transparent to-transparent"
    >
    </div>
    <div
      aria-hidden="true"
      class="absolute left-1/2 top-12 -z-10 h-72 w-72 -translate-x-1/2 rounded-full bg-accent/15 blur-[120px]"
    >
    </div>
    <div class="mx-auto max-w-6xl px-6 pb-32 pt-36">
      <div class="grid gap-16 md:grid-cols-[minmax(0,1fr)_minmax(280px,0.9fr)] md:items-center">
        <HeroStatic />
        <HeroVisualStatic />
      </div>
    </div>
  </section>

  <section class="mx-auto max-w-6xl px-6 pb-16">
    <p class="text-xs uppercase tracking-[0.32em] text-accent/80">Kolaborasi & karya</p>
    <h2 class="mt-2 text-sm text-text2">
      Produk yang saya bangun membantu pendidikan, ritel, dan ekosistem digital lainnya melaju lebih
      cepat.
    </h2>
    <div class="mt-6">
      <LogoMarquee items={marqueeLogos} duration={26} />
    </div>
  </section>

  <section class="mx-auto max-w-6xl px-6 pb-24">
    <p class="text-xs uppercase tracking-[0.32em] text-accent/80">Dampak produk</p>
    <h2 class="mt-3 max-w-3xl font-heading text-[1.9rem] font-semibold text-text md:text-[2.35rem]">
      Saya merangkai arsitektur, animasi, dan alur operasional yang menggerakkan sekolah, ritel, dan
      komunitas teknologi.
    </h2>
    <p class="mt-4 max-w-2xl text-sm text-text2 md:text-base">
      Setiap kartu merangkum bagaimana pendekatan detailâ€”dari kontrak data bersama hingga fallback
      koneksiâ€”mendorong tim shipping fitur lebih percaya diri.
    </p>
    <div class="mt-10 grid gap-6 md:grid-cols-2">
      {impactHighlights.map((card, index) => <TiltingCard client:idle {...card} index={index} />)}
    </div>
  </section>

  <Section
    id="projects"
    eyebrow="Featured"
    title="Studi kasus terpilih"
    description="4 proyek yang menonjolkan strategi pengalaman end-to-end: dari riset, desain, hingga implementasi front-end performa tinggi."
  >
    <div class="grid gap-8 md:grid-cols-2">
      {
        featured.map(({ data, slug }, index) => (
          <ProjectCard project={data} slug={slug} revealDelay={index * 0.12} />
        ))
      }
    </div>
  </Section>

  {
    processSteps.length > 0 && (
      <Section
        eyebrow="Layanan"
        title="Cara saya membantu tim Anda"
        description={
          primaryService?.description ??
          "Kerangka empat langkah yang menyatukan riset, prototyping, dan implementasi hingga siap diluncurkan."
        }
      >
        {primaryService && (
          <p class="text-xs uppercase tracking-[0.32em] text-accent/70">{primaryService.title}</p>
        )}
        <div class="mt-10 grid gap-6 md:grid-cols-2 xl:grid-cols-4">
          {processSteps.map((step, index) => (
            <ProcessStepCard client:visible {...step} index={index} />
          ))}
        </div>
      </Section>
    )
  }

  {
    testimonials.length > 0 && (
      <Section
        eyebrow="Testimoni"
        title="Suara kolaborator"
        description="Rekan kerja dan klien tentang dampak kolaborasi kami."
      >
        <div class="grid gap-12 md:grid-cols-2 md:gap-16">
          {testimonials.map(({ data }, index) => (
            <MotionReveal
              client:visible
              delay={index * 0.1}
              className={`h-full ${
                index % 2 === 1 ? "md:border-l md:border-divider/30 md:pl-12" : ""
              }`}
            >
              <div class="flex h-full flex-col justify-between gap-8">
                <div class="flex items-start gap-4">
                  <span aria-hidden="true" class="text-6xl leading-none text-divider/40">
                    "
                  </span>
                  <span class="block text-base leading-relaxed text-text md:text-lg">
                    {data.quote}
                  </span>
                  <span aria-hidden="true" class="self-end text-5xl leading-none text-divider/40">
                    "
                  </span>
                </div>
                <div class="flex items-center gap-3">
                  {data.avatar && (
                    <PillImageReveal
                      src={data.avatar}
                      alt={data.name}
                      width={56}
                      height={56}
                      class="h-14 w-14"
                    />
                  )}
                  <div>
                    <span class="block font-heading text-sm text-text">{data.name}</span>
                    <span class="block text-xs uppercase tracking-[0.28em] text-text2">
                      {data.role}
                    </span>
                  </div>
                </div>
              </div>
            </MotionReveal>
          ))}
        </div>
      </Section>
    )
  }
</Base>
