---
import Base from "~/layouts/Base.astro";
import Section from "~/components/Section.astro";
import ProjectCard from "~/components/ProjectCard.astro";
import MotionReveal from "~/components/MotionReveal";
import HeroVisual from "~/components/HeroVisual";
import HeroIntro from "~/components/HeroIntro";
import LogoMarquee from "~/components/LogoMarquee.astro";
import StaggeredText from "~/components/StaggeredText";
import TiltingCard from "~/components/TiltingCard";
import BlurStaggerText from "~/components/BlurStaggerText";
import PillImageReveal from "~/components/PillImageReveal.astro";
import ProcessStepCard from "~/components/ProcessStepCard";
import { getCollection } from "astro:content";
import { SITE } from "~/lib/seo";

const projects = await getCollection("projects", ({ data }) => data.featured);
const featured = projects.sort((a, b) => (a.data.date > b.data.date ? -1 : 1)).slice(0, 4);
const servicesCollection = await getCollection("services");
const testimonials = await getCollection("testimonials");
const marqueeLogos = [
  { prefix: "EdTech", label: "Admin Panel SMA" },
  { prefix: "LMS", label: "Classroom Informatika" },
  { prefix: "Live Learning", label: "GEMA SMAWA" },
  { prefix: "Retail", label: "Kios POS" },
  { prefix: "Enterprise", label: "Buroq Admin Panel" },
  { prefix: "Fintech", label: "Elysian Bank" },
  { prefix: "Streaming", label: "Nebula TV" },
  { prefix: "Ecommerce", label: "Aurora Commerce" },
  { prefix: "Health", label: "Pulse Health" },
];
const impactHighlights = [
  {
    title: "Absensi real-time untuk 1.200+ siswa",
    description:
      "Monorepo admin-panel-sma menghubungkan NestJS, BullMQ, dan React Admin sehingga data kehadiran terkirim otomatis ke worker dan rapor siap unduh tanpa duplikasi.",
    metric: "95% kehadiran <10.00",
    icon: "üéì",
  },
  {
    title: "Live kelas tetap stabil di jaringan sekolah",
    description:
      "GEMA SMAWA menghadirkan LiveKit dan fallback SSE sehingga streaming materi Informatika tetap mulus dengan animasi joyful yang menjaga fokus siswa.",
    metric: "37% boost retensi",
    icon: "üì°",
  },
  {
    title: "POS web yang siap barcode & mock offline",
    description:
      "Kios POS menggabungkan Next.js + tRPC + Supabase dengan mode mock MSW, memastikan kasir dapat memproses transaksi dan struk PDF walau koneksi tersendat.",
    metric: "3s per transaksi",
    icon: "üõí",
  },
  {
    title: "Admin panel enterprise dengan monitoring real-time",
    description:
      "Buroq Admin Panel menyatukan React + TypeScript + Vite untuk dashboard komprehensif dengan Google Maps integration, WhatsApp Bot, dan analytics real-time.",
    metric: "Type-safe & scalable",
    icon: "‚öôÔ∏è",
  },
];
const processSteps = [
  {
    step: "01",
    title: "Discover",
    description:
      "Audit kebutuhan bisnis, riset pengguna, dan mapping modul teknis agar prioritas jelas sebelum menulis satu baris kode.",
  },
  {
    step: "02",
    title: "Frame & Prototype",
    description:
      "Menyusun alur layanan, interaksi, dan animasi utama dalam prototipe high fidelity sehingga stakeholder bisa menguji dalam 1‚Äì2 minggu.",
  },
  {
    step: "03",
    title: "Build & Orchestrate",
    description:
      "Implementasi front-end performa tinggi‚Äîlengkap dengan aksesibilitas, state management, dan integrasi audio/animasi yang terukur.",
  },
  {
    step: "04",
    title: "Launch & Scale",
    description:
      "Menjaga rilis stabil lewat observabilitas, dokumentasi deployment, serta handover playbook supaya tim internal bisa melanjutkan dengan percaya diri.",
  },
];
const primaryService = servicesCollection[0]?.data;

const homePageSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  name: SITE.title,
  description: SITE.description,
  url: SITE.url,
};
---

<Base structuredData={homePageSchema}>
  <section class="relative overflow-hidden">
    <div
      aria-hidden="true"
      class="absolute inset-0 -z-10 bg-gradient-to-br from-accent/10 via-transparent to-transparent"
    >
    </div>
    <div
      aria-hidden="true"
      class="absolute left-1/2 top-12 -z-10 h-72 w-72 -translate-x-1/2 rounded-full bg-accent/15 blur-[120px]"
    >
    </div>
    <div class="mx-auto max-w-6xl px-6 pb-32 pt-36">
      <div class="grid gap-16 md:grid-cols-[minmax(0,1fr)_minmax(280px,0.9fr)] md:items-center">
        <HeroIntro client:idle />
        <HeroVisual client:visible />
      </div>
    </div>
  </section>

  <section class="mx-auto max-w-6xl px-6 pb-16">
    <p class="text-xs uppercase tracking-[0.32em] text-accent/80">Kolaborasi & karya</p>
    <h2 class="mt-2 text-sm text-text2">
      Produk yang saya bangun membantu pendidikan, ritel, dan ekosistem digital lainnya melaju lebih
      cepat.
    </h2>
    <div class="mt-6">
      <LogoMarquee items={marqueeLogos} duration={26} />
    </div>
  </section>

  <section class="mx-auto max-w-6xl px-6 pb-24">
    <p class="text-xs uppercase tracking-[0.32em] text-accent/80">Dampak produk</p>
    <StaggeredText
      client:visible
      text="Saya merangkai arsitektur, animasi, dan alur operasional yang menggerakkan sekolah, ritel, dan komunitas teknologi."
      as="h2"
      className="mt-3 max-w-3xl font-heading text-[1.9rem] font-semibold text-text md:text-[2.35rem]"
      delay={0.1}
    />
    <p class="mt-4 max-w-2xl text-sm text-text2 md:text-base">
      Setiap kartu merangkum bagaimana pendekatan detail‚Äîdari kontrak data bersama hingga fallback
      koneksi‚Äîmendorong tim shipping fitur lebih percaya diri.
    </p>
    <div class="mt-10 grid gap-6 md:grid-cols-2">
      {impactHighlights.map((card, index) => <TiltingCard client:idle {...card} index={index} />)}
    </div>
  </section>

  <Section
    id="projects"
    eyebrow="Featured"
    title="Studi kasus terpilih"
    description="3 proyek yang menonjolkan strategi pengalaman end-to-end: dari riset, desain, hingga implementasi front-end performa tinggi."
  >
    <div class="grid gap-8 md:grid-cols-2">
      {
        featured.map(({ data, slug }, index) => (
          <ProjectCard project={data} slug={slug} revealDelay={index * 0.12} />
        ))
      }
    </div>
  </Section>

  {
    processSteps.length > 0 && (
      <Section
        eyebrow="Layanan"
        title="Cara saya membantu tim Anda"
        description={
          primaryService?.description ??
          "Kerangka empat langkah yang menyatukan riset, prototyping, dan implementasi hingga siap diluncurkan."
        }
      >
        {primaryService && (
          <p class="text-xs uppercase tracking-[0.32em] text-accent/70">{primaryService.title}</p>
        )}
        <div class="mt-10 grid gap-6 md:grid-cols-2 xl:grid-cols-4">
          {processSteps.map((step, index) => (
            <ProcessStepCard client:visible {...step} index={index} />
          ))}
        </div>
      </Section>
    )
  }

  {
    testimonials.length > 0 && (
      <Section
        eyebrow="Testimoni"
        title="Suara kolaborator"
        description="Rekan kerja dan klien tentang dampak kolaborasi kami."
      >
        <div class="grid gap-12 md:grid-cols-2 md:gap-16">
          {testimonials.map(({ data }, index) => (
            <MotionReveal
              client:visible
              delay={index * 0.1}
              className={`h-full ${
                index % 2 === 1 ? "md:border-l md:border-divider/30 md:pl-12" : ""
              }`}
            >
              <div class="flex h-full flex-col justify-between gap-8">
                <div class="flex items-start gap-4">
                  <span aria-hidden="true" class="text-6xl leading-none text-divider/40">
                    "
                  </span>
                  <BlurStaggerText
                    client:visible
                    text={data.quote}
                    as="span"
                    className="block text-base leading-relaxed text-text md:text-lg"
                    delay={0.08}
                  />
                  <span aria-hidden="true" class="self-end text-5xl leading-none text-divider/40">
                    ‚Äù
                  </span>
                </div>
                <div class="flex items-center gap-3">
                  {data.avatar && (
                    <PillImageReveal
                      src={data.avatar}
                      alt={data.name}
                      width={56}
                      height={56}
                      class="h-14 w-14"
                    />
                  )}
                  <div>
                    <span class="block font-heading text-sm text-text">{data.name}</span>
                    <span class="block text-xs uppercase tracking-[0.28em] text-text2">
                      {data.role}
                    </span>
                  </div>
                </div>
              </div>
            </MotionReveal>
          ))}
        </div>
      </Section>
    )
  }
</Base>
