---
import "~/styles/globals.css";
import Navbar from "~/components/Navbar.astro";
import Footer from "~/components/Footer.astro";
import SEO from "~/components/SEO.astro";
import AnimationGuard from "~/components/AnimationGuard.astro";
import { SITE, personSchema, websiteSchema, buildBreadcrumbs, type Breadcrumb } from "~/lib/seo";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  structuredData?: Record<string, unknown> | Record<string, unknown>[];
  breadcrumbs?: Breadcrumb[];
  noindex?: boolean;
}

const {
  title = SITE.title,
  description = SITE.description,
  image = "/og-default.svg",
  structuredData,
  breadcrumbs = [],
  noindex = false,
} = Astro.props;

const additionalData = Array.isArray(structuredData)
  ? structuredData
  : structuredData
    ? [structuredData]
    : [];

const breadcrumbTrail = breadcrumbs.length
  ? buildBreadcrumbs([{ name: "Beranda", url: "/" }, ...breadcrumbs])
  : null;

const jsonLd = [
  personSchema,
  websiteSchema,
  ...(breadcrumbTrail ? [breadcrumbTrail] : []),
  ...additionalData,
];
---

<html lang="id" class="scroll-smooth">
  <head>
    <SEO
      title={title}
      description={description}
      image={image}
      structuredData={jsonLd}
      noindex={noindex}
    />
  </head>
  <body class="bg-bg text-text antialiased">
    <AnimationGuard />
    <Navbar />
    <main class="min-h-[60vh]">
      <slot />
    </main>
    <Footer />
  </body>
</html>
